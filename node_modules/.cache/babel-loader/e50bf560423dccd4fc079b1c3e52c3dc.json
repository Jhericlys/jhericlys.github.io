{"ast":null,"code":"var _jsxFileName = \"C:\\\\Programacao\\\\CCB\\\\Web\\\\src\\\\contexts\\\\cart.jsx\",\n    _s = $RefreshSig$();\n\nimport { createContext, useEffect, useState } from 'react';\nimport api from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CartContext = /*#__PURE__*/createContext({});\n\nfunction CartProvider(props) {\n  _s();\n\n  const [cart, setCart] = useState([]);\n  const [subtotalCart, setSubtotalCart] = useState(0);\n  const [descontoCart, setDescontoCart] = useState(0);\n  const [entregaCart, setEntregaCart] = useState(0);\n  const [idCupomCart, setIdCupomCart] = useState(0);\n  const [cupomCart, setCupomCart] = useState('');\n  const [msgCart, setMsgCart] = useState('');\n  const [totalCart, setTotalCart] = useState(0);\n  const [idEstabelecimentoCart, setIdEstabelecimentoCart] = useState(0);\n\n  function SalvarCart(produtos) {\n    if (produtos.length > 0) {\n      localStorage.setItem('sessionCart', JSON.stringify({\n        cupom: cupomCart,\n        id_cupom: idCupomCart,\n        id_estabelecimento: idEstabelecimentoCart,\n        entrega: entregaCart,\n        itens: produtos\n      }));\n    } else {\n      localStorage.removeItem('sessionCart');\n    }\n    /*\r\n    {\r\n        \"cupom\":\"SUPER10\",\r\n        \"id_cupom\": \"123\",\r\n        \"id_estabelecimento\":\"2\",\r\n        \"entrega\":3.5,\r\n        \"itens\":[{\r\n                    \"id_carrinho\":\"e08d3a54-a511-4b8e-82e0-eb2a74e811e7\",\r\n                    \"id_produto\":2,\r\n                    \"nome\":\"Black Dog Cheddar Bacon\",\r\n                    \"qtd\":1,\r\n                    \"vl_unit\":22.9,\r\n                    \"url_foto\":\"https://ifood.com.br/image/foto.jpg\",\r\n                    \"detalhes\":[]\r\n                }]\r\n    }\r\n    */\n\n  }\n\n  function AddItemCart(item) {\n    setCart([...cart, item]);\n    SalvarCart([...cart, item]);\n  }\n\n  function RemoveItemCart(id) {\n    const novoCart = cart.filter((item, index, arr) => {\n      return item.id_carrinho != id;\n    });\n    setCart(novoCart);\n    SalvarCart(novoCart);\n  }\n\n  function ValidarCupom() {\n    setMsgCart('');\n    SalvarCart(cart);\n    api.get('v1/cupons/validacao', {\n      params: {\n        cod_cupom: cupomCart,\n        valor: Math.trunc(subtotalCart * 100),\n        id_estabelecimento: idEstabelecimentoCart\n      }\n    }).then(response => {\n      if (response.data) {\n        let porc_cupom = response.data.porc_cupom; // 5\n\n        let vl_cupom = response.data.vl_cupom; // 10.00\n\n        setIdCupomCart(response.data.id_cupom);\n        setDescontoCart(vl_cupom + subtotalCart * porc_cupom / 100);\n      } else {\n        setIdCupomCart(0);\n        setDescontoCart(0);\n        setMsgCart('Cupom inválido');\n      }\n    }).catch(err => {\n      setIdCupomCart(0);\n      setDescontoCart(0);\n      setMsgCart('Cupom inválido');\n      console.log(err);\n    });\n  }\n\n  useEffect(() => {\n    const dados = localStorage.getItem('sessionCart');\n\n    if (dados) {\n      setCart(JSON.parse(dados).itens);\n      setCupomCart(JSON.parse(dados).cupom);\n      setIdEstabelecimentoCart(JSON.parse(dados).id_estabelecimento);\n      setEntregaCart(JSON.parse(dados).entrega);\n      setIdCupomCart(JSON.parse(dados).id_cupom);\n    }\n  }, []);\n  useEffect(() => {\n    if (cupomCart.length > 0) {\n      ValidarCupom();\n    }\n  }, [subtotalCart]);\n  useEffect(() => {\n    setMsgCart('');\n  }, [cupomCart]);\n  useEffect(() => {\n    let soma = cart.reduce((a, b) => a + b.vl_unit * b.qtd, 0);\n    setSubtotalCart(soma);\n  }, [cart]);\n  useEffect(() => {\n    setTotalCart(subtotalCart - descontoCart + entregaCart);\n  }, [subtotalCart, descontoCart, entregaCart]);\n  return /*#__PURE__*/_jsxDEV(CartContext.Provider, {\n    value: {\n      cart,\n      setCart,\n      subtotalCart,\n      setSubtotalCart,\n      descontoCart,\n      setDescontoCart,\n      entregaCart,\n      setEntregaCart,\n      idCupomCart,\n      setIdCupomCart,\n      totalCart,\n      setTotalCart,\n      idEstabelecimentoCart,\n      setIdEstabelecimentoCart,\n      AddItemCart,\n      RemoveItemCart,\n      ValidarCupom,\n      cupomCart,\n      msgCart,\n      setCupomCart,\n      setMsgCart\n    },\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 131,\n    columnNumber: 12\n  }, this);\n}\n\n_s(CartProvider, \"uJcrJ2+krc7LZDt2JXXDuFCE0EY=\");\n\n_c = CartProvider;\nexport { CartContext, CartProvider };\n\nvar _c;\n\n$RefreshReg$(_c, \"CartProvider\");","map":{"version":3,"sources":["C:/Programacao/CCB/Web/src/contexts/cart.jsx"],"names":["createContext","useEffect","useState","api","CartContext","CartProvider","props","cart","setCart","subtotalCart","setSubtotalCart","descontoCart","setDescontoCart","entregaCart","setEntregaCart","idCupomCart","setIdCupomCart","cupomCart","setCupomCart","msgCart","setMsgCart","totalCart","setTotalCart","idEstabelecimentoCart","setIdEstabelecimentoCart","SalvarCart","produtos","length","localStorage","setItem","JSON","stringify","cupom","id_cupom","id_estabelecimento","entrega","itens","removeItem","AddItemCart","item","RemoveItemCart","id","novoCart","filter","index","arr","id_carrinho","ValidarCupom","get","params","cod_cupom","valor","Math","trunc","then","response","data","porc_cupom","vl_cupom","catch","err","console","log","dados","getItem","parse","soma","reduce","a","b","vl_unit","qtd","children"],"mappings":"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","sourcesContent":["import { createContext, useEffect, useState } from 'react';\r\nimport api from '../services/api';\r\n\r\nconst CartContext = createContext({});\r\n\r\nfunction CartProvider(props){\r\n     \r\n    const [cart, setCart] = useState([]);\r\n    const [subtotalCart, setSubtotalCart] = useState(0);\r\n    const [descontoCart, setDescontoCart] = useState(0);\r\n    const [entregaCart, setEntregaCart] = useState(0);\r\n    const [idCupomCart, setIdCupomCart] = useState(0);\r\n    const [cupomCart, setCupomCart] = useState('');\r\n    const [msgCart, setMsgCart] = useState('');\r\n    const [totalCart, setTotalCart] = useState(0);\r\n    const [idEstabelecimentoCart, setIdEstabelecimentoCart] = useState(0);\r\n \r\n    function SalvarCart(produtos){\r\n\r\n        if (produtos.length > 0) {\r\n            \r\n            localStorage.setItem('sessionCart', JSON.stringify({\r\n                cupom: cupomCart,\r\n                id_cupom: idCupomCart,\r\n                id_estabelecimento: idEstabelecimentoCart,\r\n                entrega: entregaCart,\r\n                itens: produtos\r\n            }));\r\n        } else {\r\n            localStorage.removeItem('sessionCart');\r\n        }\r\n\r\n        /*\r\n        {\r\n            \"cupom\":\"SUPER10\",\r\n            \"id_cupom\": \"123\",\r\n            \"id_estabelecimento\":\"2\",\r\n            \"entrega\":3.5,\r\n            \"itens\":[{\r\n                        \"id_carrinho\":\"e08d3a54-a511-4b8e-82e0-eb2a74e811e7\",\r\n                        \"id_produto\":2,\r\n                        \"nome\":\"Black Dog Cheddar Bacon\",\r\n                        \"qtd\":1,\r\n                        \"vl_unit\":22.9,\r\n                        \"url_foto\":\"https://ifood.com.br/image/foto.jpg\",\r\n                        \"detalhes\":[]\r\n                    }]\r\n        }\r\n        */\r\n\r\n    }\r\n\r\n    function AddItemCart(item){\r\n        setCart([...cart, item]);\r\n        SalvarCart([...cart, item]);\r\n    }\r\n\r\n    function RemoveItemCart(id){\r\n        const novoCart = cart.filter((item, index, arr) => {\r\n            return item.id_carrinho != id;\r\n        });\r\n \r\n        setCart(novoCart);\r\n        SalvarCart(novoCart);\r\n    }\r\n\r\n    function ValidarCupom(){\r\n        setMsgCart('');\r\n        SalvarCart(cart);\r\n\r\n        api.get('v1/cupons/validacao', {\r\n            params: {\r\n                cod_cupom: cupomCart,\r\n                valor: Math.trunc(subtotalCart * 100),\r\n                id_estabelecimento: idEstabelecimentoCart\r\n            }\r\n        })\r\n        .then(response => {\r\n            if (response.data) {\r\n                let porc_cupom = response.data.porc_cupom; // 5\r\n                let vl_cupom = response.data.vl_cupom;  // 10.00\r\n\r\n                setIdCupomCart(response.data.id_cupom);\r\n                setDescontoCart(vl_cupom  + (subtotalCart * porc_cupom / 100));\r\n            } else {\r\n                setIdCupomCart(0);\r\n                setDescontoCart(0);\r\n                setMsgCart('Cupom inválido');\r\n            }\r\n        })\r\n        .catch(err => {\r\n            setIdCupomCart(0);\r\n            setDescontoCart(0);\r\n            setMsgCart('Cupom inválido');\r\n            console.log(err);\r\n        });\r\n    }\r\n\r\n    useEffect(() => {\r\n        const dados = localStorage.getItem('sessionCart');\r\n\r\n        if (dados){\r\n            setCart(JSON.parse(dados).itens);\r\n            setCupomCart(JSON.parse(dados).cupom);\r\n            setIdEstabelecimentoCart(JSON.parse(dados).id_estabelecimento);\r\n            setEntregaCart(JSON.parse(dados).entrega);\r\n            setIdCupomCart(JSON.parse(dados).id_cupom);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (cupomCart.length > 0) {\r\n            ValidarCupom();\r\n        }\r\n    }, [subtotalCart]);\r\n\r\n    useEffect(() => {\r\n       setMsgCart('');\r\n    }, [cupomCart]);\r\n   \r\n    useEffect(() => {\r\n        let soma = cart.reduce((a, b) => a + (b.vl_unit * b.qtd), 0);\r\n\r\n        setSubtotalCart(soma);\r\n    }, [cart]);\r\n\r\n    useEffect(() => {    \r\n        setTotalCart(subtotalCart - descontoCart + entregaCart);\r\n    }, [subtotalCart, descontoCart, entregaCart]);\r\n\r\n    return <CartContext.Provider value={{cart, setCart, subtotalCart, setSubtotalCart, descontoCart, setDescontoCart,\r\n                                        entregaCart, setEntregaCart, idCupomCart, setIdCupomCart, totalCart, setTotalCart,\r\n                                        idEstabelecimentoCart, setIdEstabelecimentoCart, AddItemCart, RemoveItemCart,\r\n                                        ValidarCupom, cupomCart, msgCart, setCupomCart, setMsgCart}}>\r\n        {props.children}\r\n    </CartContext.Provider>\r\n}\r\n\r\nexport {CartContext, CartProvider};"]},"metadata":{},"sourceType":"module"}