{"ast":null,"code":"import { _ as _objectWithoutPropertiesLoose } from '../_rollupPluginBabelHelpers-6b3bd404.js';\nimport { objectIncludes, DIRECTION } from '../core/utils.js';\nimport ActionDetails from '../core/action-details.js';\nimport '../masked/date.js';\nimport createMask, { maskedClass } from '../masked/factory.js';\nimport MaskElement from './mask-element.js';\nimport HTMLMaskElement from './html-mask-element.js';\nimport HTMLContenteditableMaskElement from './html-contenteditable-mask-element.js';\nimport IMask from '../core/holder.js';\nimport '../core/change-details.js';\nimport '../masked/pattern.js';\nimport '../masked/base.js';\nimport '../core/continuous-tail-details.js';\nimport '../masked/pattern/input-definition.js';\nimport '../masked/pattern/fixed-definition.js';\nimport '../masked/pattern/chunk-tail-details.js';\nimport '../masked/pattern/cursor.js';\nimport '../masked/regexp.js';\nimport '../masked/range.js';\nconst _excluded = [\"mask\"];\n/** Listens to element events and controls changes between element and {@link Masked} */\n\nclass InputMask {\n  /**\n    View element\n    @readonly\n  */\n\n  /**\n    Internal {@link Masked} model\n    @readonly\n  */\n\n  /**\n    @param {MaskElement|HTMLInputElement|HTMLTextAreaElement} el\n    @param {Object} opts\n  */\n  constructor(el, opts) {\n    this.el = el instanceof MaskElement ? el : el.isContentEditable && el.tagName !== 'INPUT' && el.tagName !== 'TEXTAREA' ? new HTMLContenteditableMaskElement(el) : new HTMLMaskElement(el);\n    this.masked = createMask(opts);\n    this._listeners = {};\n    this._value = '';\n    this._unmaskedValue = '';\n    this._saveSelection = this._saveSelection.bind(this);\n    this._onInput = this._onInput.bind(this);\n    this._onChange = this._onChange.bind(this);\n    this._onDrop = this._onDrop.bind(this);\n    this._onFocus = this._onFocus.bind(this);\n    this._onClick = this._onClick.bind(this);\n    this.alignCursor = this.alignCursor.bind(this);\n    this.alignCursorFriendly = this.alignCursorFriendly.bind(this);\n\n    this._bindEvents(); // refresh\n\n\n    this.updateValue();\n\n    this._onChange();\n  }\n  /** Read or update mask */\n\n\n  get mask() {\n    return this.masked.mask;\n  }\n\n  maskEquals(mask) {\n    var _this$masked;\n\n    return mask == null || ((_this$masked = this.masked) === null || _this$masked === void 0 ? void 0 : _this$masked.maskEquals(mask));\n  }\n\n  set mask(mask) {\n    if (this.maskEquals(mask)) return; // $FlowFixMe No ideas ... after update\n\n    if (!(mask instanceof IMask.Masked) && this.masked.constructor === maskedClass(mask)) {\n      this.masked.updateOptions({\n        mask\n      });\n      return;\n    }\n\n    const masked = createMask({\n      mask\n    });\n    masked.unmaskedValue = this.masked.unmaskedValue;\n    this.masked = masked;\n  }\n  /** Raw value */\n\n\n  get value() {\n    return this._value;\n  }\n\n  set value(str) {\n    if (this.value === str) return;\n    this.masked.value = str;\n    this.updateControl();\n    this.alignCursor();\n  }\n  /** Unmasked value */\n\n\n  get unmaskedValue() {\n    return this._unmaskedValue;\n  }\n\n  set unmaskedValue(str) {\n    if (this.unmaskedValue === str) return;\n    this.masked.unmaskedValue = str;\n    this.updateControl();\n    this.alignCursor();\n  }\n  /** Typed unmasked value */\n\n\n  get typedValue() {\n    return this.masked.typedValue;\n  }\n\n  set typedValue(val) {\n    if (this.masked.typedValueEquals(val)) return;\n    this.masked.typedValue = val;\n    this.updateControl();\n    this.alignCursor();\n  }\n  /** Display value */\n\n\n  get displayValue() {\n    return this.masked.displayValue;\n  }\n  /**\n    Starts listening to element events\n    @protected\n  */\n\n\n  _bindEvents() {\n    this.el.bindEvents({\n      selectionChange: this._saveSelection,\n      input: this._onInput,\n      drop: this._onDrop,\n      click: this._onClick,\n      focus: this._onFocus,\n      commit: this._onChange\n    });\n  }\n  /**\n    Stops listening to element events\n    @protected\n   */\n\n\n  _unbindEvents() {\n    if (this.el) this.el.unbindEvents();\n  }\n  /**\n    Fires custom event\n    @protected\n   */\n\n\n  _fireEvent(ev) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    const listeners = this._listeners[ev];\n    if (!listeners) return;\n    listeners.forEach(l => l(...args));\n  }\n  /**\n    Current selection start\n    @readonly\n  */\n\n\n  get selectionStart() {\n    return this._cursorChanging ? this._changingCursorPos : this.el.selectionStart;\n  }\n  /** Current cursor position */\n\n\n  get cursorPos() {\n    return this._cursorChanging ? this._changingCursorPos : this.el.selectionEnd;\n  }\n\n  set cursorPos(pos) {\n    if (!this.el || !this.el.isActive) return;\n    this.el.select(pos, pos);\n\n    this._saveSelection();\n  }\n  /**\n    Stores current selection\n    @protected\n  */\n\n\n  _saveSelection() {\n    if (this.displayValue !== this.el.value) {\n      console.warn('Element value was changed outside of mask. Syncronize mask using `mask.updateValue()` to work properly.'); // eslint-disable-line no-console\n    }\n\n    this._selection = {\n      start: this.selectionStart,\n      end: this.cursorPos\n    };\n  }\n  /** Syncronizes model value from view */\n\n\n  updateValue() {\n    this.masked.value = this.el.value;\n    this._value = this.masked.value;\n  }\n  /** Syncronizes view from model value, fires change events */\n\n\n  updateControl() {\n    const newUnmaskedValue = this.masked.unmaskedValue;\n    const newValue = this.masked.value;\n    const newDisplayValue = this.displayValue;\n    const isChanged = this.unmaskedValue !== newUnmaskedValue || this.value !== newValue;\n    this._unmaskedValue = newUnmaskedValue;\n    this._value = newValue;\n    if (this.el.value !== newDisplayValue) this.el.value = newDisplayValue;\n    if (isChanged) this._fireChangeEvents();\n  }\n  /** Updates options with deep equal check, recreates @{link Masked} model if mask type changes */\n\n\n  updateOptions(opts) {\n    const {\n      mask\n    } = opts,\n          restOpts = _objectWithoutPropertiesLoose(opts, _excluded);\n\n    const updateMask = !this.maskEquals(mask);\n    const updateOpts = !objectIncludes(this.masked, restOpts);\n    if (updateMask) this.mask = mask;\n    if (updateOpts) this.masked.updateOptions(restOpts);\n    if (updateMask || updateOpts) this.updateControl();\n  }\n  /** Updates cursor */\n\n\n  updateCursor(cursorPos) {\n    if (cursorPos == null) return;\n    this.cursorPos = cursorPos; // also queue change cursor for mobile browsers\n\n    this._delayUpdateCursor(cursorPos);\n  }\n  /**\n    Delays cursor update to support mobile browsers\n    @private\n  */\n\n\n  _delayUpdateCursor(cursorPos) {\n    this._abortUpdateCursor();\n\n    this._changingCursorPos = cursorPos;\n    this._cursorChanging = setTimeout(() => {\n      if (!this.el) return; // if was destroyed\n\n      this.cursorPos = this._changingCursorPos;\n\n      this._abortUpdateCursor();\n    }, 10);\n  }\n  /**\n    Fires custom events\n    @protected\n  */\n\n\n  _fireChangeEvents() {\n    this._fireEvent('accept', this._inputEvent);\n\n    if (this.masked.isComplete) this._fireEvent('complete', this._inputEvent);\n  }\n  /**\n    Aborts delayed cursor update\n    @private\n  */\n\n\n  _abortUpdateCursor() {\n    if (this._cursorChanging) {\n      clearTimeout(this._cursorChanging);\n      delete this._cursorChanging;\n    }\n  }\n  /** Aligns cursor to nearest available position */\n\n\n  alignCursor() {\n    this.cursorPos = this.masked.nearestInputPos(this.masked.nearestInputPos(this.cursorPos, DIRECTION.LEFT));\n  }\n  /** Aligns cursor only if selection is empty */\n\n\n  alignCursorFriendly() {\n    if (this.selectionStart !== this.cursorPos) return; // skip if range is selected\n\n    this.alignCursor();\n  }\n  /** Adds listener on custom event */\n\n\n  on(ev, handler) {\n    if (!this._listeners[ev]) this._listeners[ev] = [];\n\n    this._listeners[ev].push(handler);\n\n    return this;\n  }\n  /** Removes custom event listener */\n\n\n  off(ev, handler) {\n    if (!this._listeners[ev]) return this;\n\n    if (!handler) {\n      delete this._listeners[ev];\n      return this;\n    }\n\n    const hIndex = this._listeners[ev].indexOf(handler);\n\n    if (hIndex >= 0) this._listeners[ev].splice(hIndex, 1);\n    return this;\n  }\n  /** Handles view input event */\n\n\n  _onInput(e) {\n    this._inputEvent = e;\n\n    this._abortUpdateCursor(); // fix strange IE behavior\n\n\n    if (!this._selection) return this.updateValue();\n    const details = new ActionDetails( // new state\n    this.el.value, this.cursorPos, // old state\n    this.displayValue, this._selection);\n    const oldRawValue = this.masked.rawInputValue;\n    const offset = this.masked.splice(details.startChangePos, details.removed.length, details.inserted, details.removeDirection, {\n      input: true,\n      raw: true\n    }).offset; // force align in remove direction only if no input chars were removed\n    // otherwise we still need to align with NONE (to get out from fixed symbols for instance)\n\n    const removeDirection = oldRawValue === this.masked.rawInputValue ? details.removeDirection : DIRECTION.NONE;\n    let cursorPos = this.masked.nearestInputPos(details.startChangePos + offset, removeDirection);\n    if (removeDirection !== DIRECTION.NONE) cursorPos = this.masked.nearestInputPos(cursorPos, DIRECTION.NONE);\n    this.updateControl();\n    this.updateCursor(cursorPos);\n    delete this._inputEvent;\n  }\n  /** Handles view change event and commits model value */\n\n\n  _onChange() {\n    if (this.displayValue !== this.el.value) {\n      this.updateValue();\n    }\n\n    this.masked.doCommit();\n    this.updateControl();\n\n    this._saveSelection();\n  }\n  /** Handles view drop event, prevents by default */\n\n\n  _onDrop(ev) {\n    ev.preventDefault();\n    ev.stopPropagation();\n  }\n  /** Restore last selection on focus */\n\n\n  _onFocus(ev) {\n    this.alignCursorFriendly();\n  }\n  /** Restore last selection on focus */\n\n\n  _onClick(ev) {\n    this.alignCursorFriendly();\n  }\n  /** Unbind view events and removes element reference */\n\n\n  destroy() {\n    this._unbindEvents(); // $FlowFixMe why not do so?\n\n\n    this._listeners.length = 0; // $FlowFixMe\n\n    delete this.el;\n  }\n\n}\n\nIMask.InputMask = InputMask;\nexport { InputMask as default };","map":{"version":3,"sources":["C:/Programacao/CCB/Web/node_modules/imask/esm/controls/input.js"],"names":["_","_objectWithoutPropertiesLoose","objectIncludes","DIRECTION","ActionDetails","createMask","maskedClass","MaskElement","HTMLMaskElement","HTMLContenteditableMaskElement","IMask","_excluded","InputMask","constructor","el","opts","isContentEditable","tagName","masked","_listeners","_value","_unmaskedValue","_saveSelection","bind","_onInput","_onChange","_onDrop","_onFocus","_onClick","alignCursor","alignCursorFriendly","_bindEvents","updateValue","mask","maskEquals","_this$masked","Masked","updateOptions","unmaskedValue","value","str","updateControl","typedValue","val","typedValueEquals","displayValue","bindEvents","selectionChange","input","drop","click","focus","commit","_unbindEvents","unbindEvents","_fireEvent","ev","_len","arguments","length","args","Array","_key","listeners","forEach","l","selectionStart","_cursorChanging","_changingCursorPos","cursorPos","selectionEnd","pos","isActive","select","console","warn","_selection","start","end","newUnmaskedValue","newValue","newDisplayValue","isChanged","_fireChangeEvents","restOpts","updateMask","updateOpts","updateCursor","_delayUpdateCursor","_abortUpdateCursor","setTimeout","_inputEvent","isComplete","clearTimeout","nearestInputPos","LEFT","on","handler","push","off","hIndex","indexOf","splice","e","details","oldRawValue","rawInputValue","offset","startChangePos","removed","inserted","removeDirection","raw","NONE","doCommit","preventDefault","stopPropagation","destroy","default"],"mappings":"AAAA,SAASA,CAAC,IAAIC,6BAAd,QAAmD,0CAAnD;AACA,SAASC,cAAT,EAAyBC,SAAzB,QAA0C,kBAA1C;AACA,OAAOC,aAAP,MAA0B,2BAA1B;AACA,OAAO,mBAAP;AACA,OAAOC,UAAP,IAAqBC,WAArB,QAAwC,sBAAxC;AACA,OAAOC,WAAP,MAAwB,mBAAxB;AACA,OAAOC,eAAP,MAA4B,wBAA5B;AACA,OAAOC,8BAAP,MAA2C,wCAA3C;AACA,OAAOC,KAAP,MAAkB,mBAAlB;AACA,OAAO,2BAAP;AACA,OAAO,sBAAP;AACA,OAAO,mBAAP;AACA,OAAO,oCAAP;AACA,OAAO,uCAAP;AACA,OAAO,uCAAP;AACA,OAAO,yCAAP;AACA,OAAO,6BAAP;AACA,OAAO,qBAAP;AACA,OAAO,oBAAP;AAEA,MAAMC,SAAS,GAAG,CAAC,MAAD,CAAlB;AAEA;;AACA,MAAMC,SAAN,CAAgB;AACd;AACF;AACA;AACA;;AAEE;AACF;AACA;AACA;;AAEE;AACF;AACA;AACA;AACEC,EAAAA,WAAW,CAACC,EAAD,EAAKC,IAAL,EAAW;AACpB,SAAKD,EAAL,GAAUA,EAAE,YAAYP,WAAd,GAA4BO,EAA5B,GAAiCA,EAAE,CAACE,iBAAH,IAAwBF,EAAE,CAACG,OAAH,KAAe,OAAvC,IAAkDH,EAAE,CAACG,OAAH,KAAe,UAAjE,GAA8E,IAAIR,8BAAJ,CAAmCK,EAAnC,CAA9E,GAAuH,IAAIN,eAAJ,CAAoBM,EAApB,CAAlK;AACA,SAAKI,MAAL,GAAcb,UAAU,CAACU,IAAD,CAAxB;AACA,SAAKI,UAAL,GAAkB,EAAlB;AACA,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,cAAL,GAAsB,EAAtB;AACA,SAAKC,cAAL,GAAsB,KAAKA,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAAtB;AACA,SAAKC,QAAL,GAAgB,KAAKA,QAAL,CAAcD,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKE,SAAL,GAAiB,KAAKA,SAAL,CAAeF,IAAf,CAAoB,IAApB,CAAjB;AACA,SAAKG,OAAL,GAAe,KAAKA,OAAL,CAAaH,IAAb,CAAkB,IAAlB,CAAf;AACA,SAAKI,QAAL,GAAgB,KAAKA,QAAL,CAAcJ,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKK,QAAL,GAAgB,KAAKA,QAAL,CAAcL,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKM,WAAL,GAAmB,KAAKA,WAAL,CAAiBN,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAKO,mBAAL,GAA2B,KAAKA,mBAAL,CAAyBP,IAAzB,CAA8B,IAA9B,CAA3B;;AACA,SAAKQ,WAAL,GAdoB,CAgBpB;;;AACA,SAAKC,WAAL;;AACA,SAAKP,SAAL;AACD;AAED;;;AACQ,MAAJQ,IAAI,GAAG;AACT,WAAO,KAAKf,MAAL,CAAYe,IAAnB;AACD;;AACDC,EAAAA,UAAU,CAACD,IAAD,EAAO;AACf,QAAIE,YAAJ;;AACA,WAAOF,IAAI,IAAI,IAAR,KAAiB,CAACE,YAAY,GAAG,KAAKjB,MAArB,MAAiC,IAAjC,IAAyCiB,YAAY,KAAK,KAAK,CAA/D,GAAmE,KAAK,CAAxE,GAA4EA,YAAY,CAACD,UAAb,CAAwBD,IAAxB,CAA7F,CAAP;AACD;;AACO,MAAJA,IAAI,CAACA,IAAD,EAAO;AACb,QAAI,KAAKC,UAAL,CAAgBD,IAAhB,CAAJ,EAA2B,OADd,CAGb;;AACA,QAAI,EAAEA,IAAI,YAAYvB,KAAK,CAAC0B,MAAxB,KAAmC,KAAKlB,MAAL,CAAYL,WAAZ,KAA4BP,WAAW,CAAC2B,IAAD,CAA9E,EAAsF;AACpF,WAAKf,MAAL,CAAYmB,aAAZ,CAA0B;AACxBJ,QAAAA;AADwB,OAA1B;AAGA;AACD;;AACD,UAAMf,MAAM,GAAGb,UAAU,CAAC;AACxB4B,MAAAA;AADwB,KAAD,CAAzB;AAGAf,IAAAA,MAAM,CAACoB,aAAP,GAAuB,KAAKpB,MAAL,CAAYoB,aAAnC;AACA,SAAKpB,MAAL,GAAcA,MAAd;AACD;AAED;;;AACS,MAALqB,KAAK,GAAG;AACV,WAAO,KAAKnB,MAAZ;AACD;;AACQ,MAALmB,KAAK,CAACC,GAAD,EAAM;AACb,QAAI,KAAKD,KAAL,KAAeC,GAAnB,EAAwB;AACxB,SAAKtB,MAAL,CAAYqB,KAAZ,GAAoBC,GAApB;AACA,SAAKC,aAAL;AACA,SAAKZ,WAAL;AACD;AAED;;;AACiB,MAAbS,aAAa,GAAG;AAClB,WAAO,KAAKjB,cAAZ;AACD;;AACgB,MAAbiB,aAAa,CAACE,GAAD,EAAM;AACrB,QAAI,KAAKF,aAAL,KAAuBE,GAA3B,EAAgC;AAChC,SAAKtB,MAAL,CAAYoB,aAAZ,GAA4BE,GAA5B;AACA,SAAKC,aAAL;AACA,SAAKZ,WAAL;AACD;AAED;;;AACc,MAAVa,UAAU,GAAG;AACf,WAAO,KAAKxB,MAAL,CAAYwB,UAAnB;AACD;;AACa,MAAVA,UAAU,CAACC,GAAD,EAAM;AAClB,QAAI,KAAKzB,MAAL,CAAY0B,gBAAZ,CAA6BD,GAA7B,CAAJ,EAAuC;AACvC,SAAKzB,MAAL,CAAYwB,UAAZ,GAAyBC,GAAzB;AACA,SAAKF,aAAL;AACA,SAAKZ,WAAL;AACD;AAED;;;AACgB,MAAZgB,YAAY,GAAG;AACjB,WAAO,KAAK3B,MAAL,CAAY2B,YAAnB;AACD;AAED;AACF;AACA;AACA;;;AACEd,EAAAA,WAAW,GAAG;AACZ,SAAKjB,EAAL,CAAQgC,UAAR,CAAmB;AACjBC,MAAAA,eAAe,EAAE,KAAKzB,cADL;AAEjB0B,MAAAA,KAAK,EAAE,KAAKxB,QAFK;AAGjByB,MAAAA,IAAI,EAAE,KAAKvB,OAHM;AAIjBwB,MAAAA,KAAK,EAAE,KAAKtB,QAJK;AAKjBuB,MAAAA,KAAK,EAAE,KAAKxB,QALK;AAMjByB,MAAAA,MAAM,EAAE,KAAK3B;AANI,KAAnB;AAQD;AAED;AACF;AACA;AACA;;;AACE4B,EAAAA,aAAa,GAAG;AACd,QAAI,KAAKvC,EAAT,EAAa,KAAKA,EAAL,CAAQwC,YAAR;AACd;AAED;AACF;AACA;AACA;;;AACEC,EAAAA,UAAU,CAACC,EAAD,EAAK;AACb,SAAK,IAAIC,IAAI,GAAGC,SAAS,CAACC,MAArB,EAA6BC,IAAI,GAAG,IAAIC,KAAJ,CAAUJ,IAAI,GAAG,CAAP,GAAWA,IAAI,GAAG,CAAlB,GAAsB,CAAhC,CAApC,EAAwEK,IAAI,GAAG,CAApF,EAAuFA,IAAI,GAAGL,IAA9F,EAAoGK,IAAI,EAAxG,EAA4G;AAC1GF,MAAAA,IAAI,CAACE,IAAI,GAAG,CAAR,CAAJ,GAAiBJ,SAAS,CAACI,IAAD,CAA1B;AACD;;AACD,UAAMC,SAAS,GAAG,KAAK5C,UAAL,CAAgBqC,EAAhB,CAAlB;AACA,QAAI,CAACO,SAAL,EAAgB;AAChBA,IAAAA,SAAS,CAACC,OAAV,CAAkBC,CAAC,IAAIA,CAAC,CAAC,GAAGL,IAAJ,CAAxB;AACD;AAED;AACF;AACA;AACA;;;AACoB,MAAdM,cAAc,GAAG;AACnB,WAAO,KAAKC,eAAL,GAAuB,KAAKC,kBAA5B,GAAiD,KAAKtD,EAAL,CAAQoD,cAAhE;AACD;AAED;;;AACa,MAATG,SAAS,GAAG;AACd,WAAO,KAAKF,eAAL,GAAuB,KAAKC,kBAA5B,GAAiD,KAAKtD,EAAL,CAAQwD,YAAhE;AACD;;AACY,MAATD,SAAS,CAACE,GAAD,EAAM;AACjB,QAAI,CAAC,KAAKzD,EAAN,IAAY,CAAC,KAAKA,EAAL,CAAQ0D,QAAzB,EAAmC;AACnC,SAAK1D,EAAL,CAAQ2D,MAAR,CAAeF,GAAf,EAAoBA,GAApB;;AACA,SAAKjD,cAAL;AACD;AAED;AACF;AACA;AACA;;;AACEA,EAAAA,cAAc,GACZ;AACA,QAAI,KAAKuB,YAAL,KAAsB,KAAK/B,EAAL,CAAQyB,KAAlC,EAAyC;AACvCmC,MAAAA,OAAO,CAACC,IAAR,CAAa,yGAAb,EADuC,CACkF;AAC1H;;AAED,SAAKC,UAAL,GAAkB;AAChBC,MAAAA,KAAK,EAAE,KAAKX,cADI;AAEhBY,MAAAA,GAAG,EAAE,KAAKT;AAFM,KAAlB;AAID;AAED;;;AACArC,EAAAA,WAAW,GAAG;AACZ,SAAKd,MAAL,CAAYqB,KAAZ,GAAoB,KAAKzB,EAAL,CAAQyB,KAA5B;AACA,SAAKnB,MAAL,GAAc,KAAKF,MAAL,CAAYqB,KAA1B;AACD;AAED;;;AACAE,EAAAA,aAAa,GAAG;AACd,UAAMsC,gBAAgB,GAAG,KAAK7D,MAAL,CAAYoB,aAArC;AACA,UAAM0C,QAAQ,GAAG,KAAK9D,MAAL,CAAYqB,KAA7B;AACA,UAAM0C,eAAe,GAAG,KAAKpC,YAA7B;AACA,UAAMqC,SAAS,GAAG,KAAK5C,aAAL,KAAuByC,gBAAvB,IAA2C,KAAKxC,KAAL,KAAeyC,QAA5E;AACA,SAAK3D,cAAL,GAAsB0D,gBAAtB;AACA,SAAK3D,MAAL,GAAc4D,QAAd;AACA,QAAI,KAAKlE,EAAL,CAAQyB,KAAR,KAAkB0C,eAAtB,EAAuC,KAAKnE,EAAL,CAAQyB,KAAR,GAAgB0C,eAAhB;AACvC,QAAIC,SAAJ,EAAe,KAAKC,iBAAL;AAChB;AAED;;;AACA9C,EAAAA,aAAa,CAACtB,IAAD,EAAO;AAClB,UAAM;AACFkB,MAAAA;AADE,QAEAlB,IAFN;AAAA,UAGEqE,QAAQ,GAAGnF,6BAA6B,CAACc,IAAD,EAAOJ,SAAP,CAH1C;;AAIA,UAAM0E,UAAU,GAAG,CAAC,KAAKnD,UAAL,CAAgBD,IAAhB,CAApB;AACA,UAAMqD,UAAU,GAAG,CAACpF,cAAc,CAAC,KAAKgB,MAAN,EAAckE,QAAd,CAAlC;AACA,QAAIC,UAAJ,EAAgB,KAAKpD,IAAL,GAAYA,IAAZ;AAChB,QAAIqD,UAAJ,EAAgB,KAAKpE,MAAL,CAAYmB,aAAZ,CAA0B+C,QAA1B;AAChB,QAAIC,UAAU,IAAIC,UAAlB,EAA8B,KAAK7C,aAAL;AAC/B;AAED;;;AACA8C,EAAAA,YAAY,CAAClB,SAAD,EAAY;AACtB,QAAIA,SAAS,IAAI,IAAjB,EAAuB;AACvB,SAAKA,SAAL,GAAiBA,SAAjB,CAFsB,CAItB;;AACA,SAAKmB,kBAAL,CAAwBnB,SAAxB;AACD;AAED;AACF;AACA;AACA;;;AACEmB,EAAAA,kBAAkB,CAACnB,SAAD,EAAY;AAC5B,SAAKoB,kBAAL;;AACA,SAAKrB,kBAAL,GAA0BC,SAA1B;AACA,SAAKF,eAAL,GAAuBuB,UAAU,CAAC,MAAM;AACtC,UAAI,CAAC,KAAK5E,EAAV,EAAc,OADwB,CAChB;;AACtB,WAAKuD,SAAL,GAAiB,KAAKD,kBAAtB;;AACA,WAAKqB,kBAAL;AACD,KAJgC,EAI9B,EAJ8B,CAAjC;AAKD;AAED;AACF;AACA;AACA;;;AACEN,EAAAA,iBAAiB,GAAG;AAClB,SAAK5B,UAAL,CAAgB,QAAhB,EAA0B,KAAKoC,WAA/B;;AACA,QAAI,KAAKzE,MAAL,CAAY0E,UAAhB,EAA4B,KAAKrC,UAAL,CAAgB,UAAhB,EAA4B,KAAKoC,WAAjC;AAC7B;AAED;AACF;AACA;AACA;;;AACEF,EAAAA,kBAAkB,GAAG;AACnB,QAAI,KAAKtB,eAAT,EAA0B;AACxB0B,MAAAA,YAAY,CAAC,KAAK1B,eAAN,CAAZ;AACA,aAAO,KAAKA,eAAZ;AACD;AACF;AAED;;;AACAtC,EAAAA,WAAW,GAAG;AACZ,SAAKwC,SAAL,GAAiB,KAAKnD,MAAL,CAAY4E,eAAZ,CAA4B,KAAK5E,MAAL,CAAY4E,eAAZ,CAA4B,KAAKzB,SAAjC,EAA4ClE,SAAS,CAAC4F,IAAtD,CAA5B,CAAjB;AACD;AAED;;;AACAjE,EAAAA,mBAAmB,GAAG;AACpB,QAAI,KAAKoC,cAAL,KAAwB,KAAKG,SAAjC,EAA4C,OADxB,CACgC;;AACpD,SAAKxC,WAAL;AACD;AAED;;;AACAmE,EAAAA,EAAE,CAACxC,EAAD,EAAKyC,OAAL,EAAc;AACd,QAAI,CAAC,KAAK9E,UAAL,CAAgBqC,EAAhB,CAAL,EAA0B,KAAKrC,UAAL,CAAgBqC,EAAhB,IAAsB,EAAtB;;AAC1B,SAAKrC,UAAL,CAAgBqC,EAAhB,EAAoB0C,IAApB,CAAyBD,OAAzB;;AACA,WAAO,IAAP;AACD;AAED;;;AACAE,EAAAA,GAAG,CAAC3C,EAAD,EAAKyC,OAAL,EAAc;AACf,QAAI,CAAC,KAAK9E,UAAL,CAAgBqC,EAAhB,CAAL,EAA0B,OAAO,IAAP;;AAC1B,QAAI,CAACyC,OAAL,EAAc;AACZ,aAAO,KAAK9E,UAAL,CAAgBqC,EAAhB,CAAP;AACA,aAAO,IAAP;AACD;;AACD,UAAM4C,MAAM,GAAG,KAAKjF,UAAL,CAAgBqC,EAAhB,EAAoB6C,OAApB,CAA4BJ,OAA5B,CAAf;;AACA,QAAIG,MAAM,IAAI,CAAd,EAAiB,KAAKjF,UAAL,CAAgBqC,EAAhB,EAAoB8C,MAApB,CAA2BF,MAA3B,EAAmC,CAAnC;AACjB,WAAO,IAAP;AACD;AAED;;;AACA5E,EAAAA,QAAQ,CAAC+E,CAAD,EAAI;AACV,SAAKZ,WAAL,GAAmBY,CAAnB;;AACA,SAAKd,kBAAL,GAFU,CAIV;;;AACA,QAAI,CAAC,KAAKb,UAAV,EAAsB,OAAO,KAAK5C,WAAL,EAAP;AACtB,UAAMwE,OAAO,GAAG,IAAIpG,aAAJ,EAChB;AACA,SAAKU,EAAL,CAAQyB,KAFQ,EAED,KAAK8B,SAFJ,EAGhB;AACA,SAAKxB,YAJW,EAIG,KAAK+B,UAJR,CAAhB;AAKA,UAAM6B,WAAW,GAAG,KAAKvF,MAAL,CAAYwF,aAAhC;AACA,UAAMC,MAAM,GAAG,KAAKzF,MAAL,CAAYoF,MAAZ,CAAmBE,OAAO,CAACI,cAA3B,EAA2CJ,OAAO,CAACK,OAAR,CAAgBlD,MAA3D,EAAmE6C,OAAO,CAACM,QAA3E,EAAqFN,OAAO,CAACO,eAA7F,EAA8G;AAC3H/D,MAAAA,KAAK,EAAE,IADoH;AAE3HgE,MAAAA,GAAG,EAAE;AAFsH,KAA9G,EAGZL,MAHH,CAZU,CAiBV;AACA;;AACA,UAAMI,eAAe,GAAGN,WAAW,KAAK,KAAKvF,MAAL,CAAYwF,aAA5B,GAA4CF,OAAO,CAACO,eAApD,GAAsE5G,SAAS,CAAC8G,IAAxG;AACA,QAAI5C,SAAS,GAAG,KAAKnD,MAAL,CAAY4E,eAAZ,CAA4BU,OAAO,CAACI,cAAR,GAAyBD,MAArD,EAA6DI,eAA7D,CAAhB;AACA,QAAIA,eAAe,KAAK5G,SAAS,CAAC8G,IAAlC,EAAwC5C,SAAS,GAAG,KAAKnD,MAAL,CAAY4E,eAAZ,CAA4BzB,SAA5B,EAAuClE,SAAS,CAAC8G,IAAjD,CAAZ;AACxC,SAAKxE,aAAL;AACA,SAAK8C,YAAL,CAAkBlB,SAAlB;AACA,WAAO,KAAKsB,WAAZ;AACD;AAED;;;AACAlE,EAAAA,SAAS,GAAG;AACV,QAAI,KAAKoB,YAAL,KAAsB,KAAK/B,EAAL,CAAQyB,KAAlC,EAAyC;AACvC,WAAKP,WAAL;AACD;;AACD,SAAKd,MAAL,CAAYgG,QAAZ;AACA,SAAKzE,aAAL;;AACA,SAAKnB,cAAL;AACD;AAED;;;AACAI,EAAAA,OAAO,CAAC8B,EAAD,EAAK;AACVA,IAAAA,EAAE,CAAC2D,cAAH;AACA3D,IAAAA,EAAE,CAAC4D,eAAH;AACD;AAED;;;AACAzF,EAAAA,QAAQ,CAAC6B,EAAD,EAAK;AACX,SAAK1B,mBAAL;AACD;AAED;;;AACAF,EAAAA,QAAQ,CAAC4B,EAAD,EAAK;AACX,SAAK1B,mBAAL;AACD;AAED;;;AACAuF,EAAAA,OAAO,GAAG;AACR,SAAKhE,aAAL,GADQ,CAER;;;AACA,SAAKlC,UAAL,CAAgBwC,MAAhB,GAAyB,CAAzB,CAHQ,CAIR;;AACA,WAAO,KAAK7C,EAAZ;AACD;;AA9Ua;;AAgVhBJ,KAAK,CAACE,SAAN,GAAkBA,SAAlB;AAEA,SAASA,SAAS,IAAI0G,OAAtB","sourcesContent":["import { _ as _objectWithoutPropertiesLoose } from '../_rollupPluginBabelHelpers-6b3bd404.js';\nimport { objectIncludes, DIRECTION } from '../core/utils.js';\nimport ActionDetails from '../core/action-details.js';\nimport '../masked/date.js';\nimport createMask, { maskedClass } from '../masked/factory.js';\nimport MaskElement from './mask-element.js';\nimport HTMLMaskElement from './html-mask-element.js';\nimport HTMLContenteditableMaskElement from './html-contenteditable-mask-element.js';\nimport IMask from '../core/holder.js';\nimport '../core/change-details.js';\nimport '../masked/pattern.js';\nimport '../masked/base.js';\nimport '../core/continuous-tail-details.js';\nimport '../masked/pattern/input-definition.js';\nimport '../masked/pattern/fixed-definition.js';\nimport '../masked/pattern/chunk-tail-details.js';\nimport '../masked/pattern/cursor.js';\nimport '../masked/regexp.js';\nimport '../masked/range.js';\n\nconst _excluded = [\"mask\"];\n\n/** Listens to element events and controls changes between element and {@link Masked} */\nclass InputMask {\n  /**\n    View element\n    @readonly\n  */\n\n  /**\n    Internal {@link Masked} model\n    @readonly\n  */\n\n  /**\n    @param {MaskElement|HTMLInputElement|HTMLTextAreaElement} el\n    @param {Object} opts\n  */\n  constructor(el, opts) {\n    this.el = el instanceof MaskElement ? el : el.isContentEditable && el.tagName !== 'INPUT' && el.tagName !== 'TEXTAREA' ? new HTMLContenteditableMaskElement(el) : new HTMLMaskElement(el);\n    this.masked = createMask(opts);\n    this._listeners = {};\n    this._value = '';\n    this._unmaskedValue = '';\n    this._saveSelection = this._saveSelection.bind(this);\n    this._onInput = this._onInput.bind(this);\n    this._onChange = this._onChange.bind(this);\n    this._onDrop = this._onDrop.bind(this);\n    this._onFocus = this._onFocus.bind(this);\n    this._onClick = this._onClick.bind(this);\n    this.alignCursor = this.alignCursor.bind(this);\n    this.alignCursorFriendly = this.alignCursorFriendly.bind(this);\n    this._bindEvents();\n\n    // refresh\n    this.updateValue();\n    this._onChange();\n  }\n\n  /** Read or update mask */\n  get mask() {\n    return this.masked.mask;\n  }\n  maskEquals(mask) {\n    var _this$masked;\n    return mask == null || ((_this$masked = this.masked) === null || _this$masked === void 0 ? void 0 : _this$masked.maskEquals(mask));\n  }\n  set mask(mask) {\n    if (this.maskEquals(mask)) return;\n\n    // $FlowFixMe No ideas ... after update\n    if (!(mask instanceof IMask.Masked) && this.masked.constructor === maskedClass(mask)) {\n      this.masked.updateOptions({\n        mask\n      });\n      return;\n    }\n    const masked = createMask({\n      mask\n    });\n    masked.unmaskedValue = this.masked.unmaskedValue;\n    this.masked = masked;\n  }\n\n  /** Raw value */\n  get value() {\n    return this._value;\n  }\n  set value(str) {\n    if (this.value === str) return;\n    this.masked.value = str;\n    this.updateControl();\n    this.alignCursor();\n  }\n\n  /** Unmasked value */\n  get unmaskedValue() {\n    return this._unmaskedValue;\n  }\n  set unmaskedValue(str) {\n    if (this.unmaskedValue === str) return;\n    this.masked.unmaskedValue = str;\n    this.updateControl();\n    this.alignCursor();\n  }\n\n  /** Typed unmasked value */\n  get typedValue() {\n    return this.masked.typedValue;\n  }\n  set typedValue(val) {\n    if (this.masked.typedValueEquals(val)) return;\n    this.masked.typedValue = val;\n    this.updateControl();\n    this.alignCursor();\n  }\n\n  /** Display value */\n  get displayValue() {\n    return this.masked.displayValue;\n  }\n\n  /**\n    Starts listening to element events\n    @protected\n  */\n  _bindEvents() {\n    this.el.bindEvents({\n      selectionChange: this._saveSelection,\n      input: this._onInput,\n      drop: this._onDrop,\n      click: this._onClick,\n      focus: this._onFocus,\n      commit: this._onChange\n    });\n  }\n\n  /**\n    Stops listening to element events\n    @protected\n   */\n  _unbindEvents() {\n    if (this.el) this.el.unbindEvents();\n  }\n\n  /**\n    Fires custom event\n    @protected\n   */\n  _fireEvent(ev) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    const listeners = this._listeners[ev];\n    if (!listeners) return;\n    listeners.forEach(l => l(...args));\n  }\n\n  /**\n    Current selection start\n    @readonly\n  */\n  get selectionStart() {\n    return this._cursorChanging ? this._changingCursorPos : this.el.selectionStart;\n  }\n\n  /** Current cursor position */\n  get cursorPos() {\n    return this._cursorChanging ? this._changingCursorPos : this.el.selectionEnd;\n  }\n  set cursorPos(pos) {\n    if (!this.el || !this.el.isActive) return;\n    this.el.select(pos, pos);\n    this._saveSelection();\n  }\n\n  /**\n    Stores current selection\n    @protected\n  */\n  _saveSelection( /* ev */\n  ) {\n    if (this.displayValue !== this.el.value) {\n      console.warn('Element value was changed outside of mask. Syncronize mask using `mask.updateValue()` to work properly.'); // eslint-disable-line no-console\n    }\n\n    this._selection = {\n      start: this.selectionStart,\n      end: this.cursorPos\n    };\n  }\n\n  /** Syncronizes model value from view */\n  updateValue() {\n    this.masked.value = this.el.value;\n    this._value = this.masked.value;\n  }\n\n  /** Syncronizes view from model value, fires change events */\n  updateControl() {\n    const newUnmaskedValue = this.masked.unmaskedValue;\n    const newValue = this.masked.value;\n    const newDisplayValue = this.displayValue;\n    const isChanged = this.unmaskedValue !== newUnmaskedValue || this.value !== newValue;\n    this._unmaskedValue = newUnmaskedValue;\n    this._value = newValue;\n    if (this.el.value !== newDisplayValue) this.el.value = newDisplayValue;\n    if (isChanged) this._fireChangeEvents();\n  }\n\n  /** Updates options with deep equal check, recreates @{link Masked} model if mask type changes */\n  updateOptions(opts) {\n    const {\n        mask\n      } = opts,\n      restOpts = _objectWithoutPropertiesLoose(opts, _excluded);\n    const updateMask = !this.maskEquals(mask);\n    const updateOpts = !objectIncludes(this.masked, restOpts);\n    if (updateMask) this.mask = mask;\n    if (updateOpts) this.masked.updateOptions(restOpts);\n    if (updateMask || updateOpts) this.updateControl();\n  }\n\n  /** Updates cursor */\n  updateCursor(cursorPos) {\n    if (cursorPos == null) return;\n    this.cursorPos = cursorPos;\n\n    // also queue change cursor for mobile browsers\n    this._delayUpdateCursor(cursorPos);\n  }\n\n  /**\n    Delays cursor update to support mobile browsers\n    @private\n  */\n  _delayUpdateCursor(cursorPos) {\n    this._abortUpdateCursor();\n    this._changingCursorPos = cursorPos;\n    this._cursorChanging = setTimeout(() => {\n      if (!this.el) return; // if was destroyed\n      this.cursorPos = this._changingCursorPos;\n      this._abortUpdateCursor();\n    }, 10);\n  }\n\n  /**\n    Fires custom events\n    @protected\n  */\n  _fireChangeEvents() {\n    this._fireEvent('accept', this._inputEvent);\n    if (this.masked.isComplete) this._fireEvent('complete', this._inputEvent);\n  }\n\n  /**\n    Aborts delayed cursor update\n    @private\n  */\n  _abortUpdateCursor() {\n    if (this._cursorChanging) {\n      clearTimeout(this._cursorChanging);\n      delete this._cursorChanging;\n    }\n  }\n\n  /** Aligns cursor to nearest available position */\n  alignCursor() {\n    this.cursorPos = this.masked.nearestInputPos(this.masked.nearestInputPos(this.cursorPos, DIRECTION.LEFT));\n  }\n\n  /** Aligns cursor only if selection is empty */\n  alignCursorFriendly() {\n    if (this.selectionStart !== this.cursorPos) return; // skip if range is selected\n    this.alignCursor();\n  }\n\n  /** Adds listener on custom event */\n  on(ev, handler) {\n    if (!this._listeners[ev]) this._listeners[ev] = [];\n    this._listeners[ev].push(handler);\n    return this;\n  }\n\n  /** Removes custom event listener */\n  off(ev, handler) {\n    if (!this._listeners[ev]) return this;\n    if (!handler) {\n      delete this._listeners[ev];\n      return this;\n    }\n    const hIndex = this._listeners[ev].indexOf(handler);\n    if (hIndex >= 0) this._listeners[ev].splice(hIndex, 1);\n    return this;\n  }\n\n  /** Handles view input event */\n  _onInput(e) {\n    this._inputEvent = e;\n    this._abortUpdateCursor();\n\n    // fix strange IE behavior\n    if (!this._selection) return this.updateValue();\n    const details = new ActionDetails(\n    // new state\n    this.el.value, this.cursorPos,\n    // old state\n    this.displayValue, this._selection);\n    const oldRawValue = this.masked.rawInputValue;\n    const offset = this.masked.splice(details.startChangePos, details.removed.length, details.inserted, details.removeDirection, {\n      input: true,\n      raw: true\n    }).offset;\n\n    // force align in remove direction only if no input chars were removed\n    // otherwise we still need to align with NONE (to get out from fixed symbols for instance)\n    const removeDirection = oldRawValue === this.masked.rawInputValue ? details.removeDirection : DIRECTION.NONE;\n    let cursorPos = this.masked.nearestInputPos(details.startChangePos + offset, removeDirection);\n    if (removeDirection !== DIRECTION.NONE) cursorPos = this.masked.nearestInputPos(cursorPos, DIRECTION.NONE);\n    this.updateControl();\n    this.updateCursor(cursorPos);\n    delete this._inputEvent;\n  }\n\n  /** Handles view change event and commits model value */\n  _onChange() {\n    if (this.displayValue !== this.el.value) {\n      this.updateValue();\n    }\n    this.masked.doCommit();\n    this.updateControl();\n    this._saveSelection();\n  }\n\n  /** Handles view drop event, prevents by default */\n  _onDrop(ev) {\n    ev.preventDefault();\n    ev.stopPropagation();\n  }\n\n  /** Restore last selection on focus */\n  _onFocus(ev) {\n    this.alignCursorFriendly();\n  }\n\n  /** Restore last selection on focus */\n  _onClick(ev) {\n    this.alignCursorFriendly();\n  }\n\n  /** Unbind view events and removes element reference */\n  destroy() {\n    this._unbindEvents();\n    // $FlowFixMe why not do so?\n    this._listeners.length = 0;\n    // $FlowFixMe\n    delete this.el;\n  }\n}\nIMask.InputMask = InputMask;\n\nexport { InputMask as default };\n"]},"metadata":{},"sourceType":"module"}